<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PD Type & Skill Diagnostic</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
:root{
  --bg:#f3f4f6;
  --surface:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --line:#e5e7eb;
  --accent:#2563eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif;
  background:var(--bg);
  color:var(--text);
}
.wrap{max-width:1100px;margin:0 auto;padding:20px}
h1{font-size:22px;margin-bottom:4px}
h2{font-size:18px;margin:16px 0 6px}
.small{font-size:12px;color:var(--muted)}
.rule{height:1px;background:var(--line);margin:14px 0}

button{
  padding:12px 16px;
  border-radius:10px;
  border:1px solid var(--line);
  background:#fff;
  font-weight:700;
  cursor:pointer;
}
button.primary{
  background:var(--accent);
  color:#fff;
  border:none;
}
button:disabled{
  opacity:.5;cursor:not-allowed;
}

.card{
  background:#fff;
  padding:16px;
  margin-bottom:14px;
}

.tap{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  border:1.5px solid var(--line);
  border-radius:14px;
  margin-bottom:10px;
  cursor:pointer;
}
.tap.selected{
  border-color:var(--accent);
  background:#eff6ff;
}

.hidden{display:none}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:900px){.grid2{grid-template-columns:1fr}}
</style>
</head>

<body>
<div class="wrap">

<h1>PD Type & Skill Diagnostic</h1>
<div class="small">タイプ × 能力 を可視化する診断ツール</div>
<div class="rule"></div>

<!-- HOME -->
<section id="home" class="card">
<h2>1) モード選択</h2>
<div class="tap" onclick="setMode('self')" id="modeSelf">自己評価</div>
<div class="tap" onclick="setMode('other')" id="modeOther">他者評価</div>
<button class="primary" id="startBtn" disabled onclick="start()">スタート</button>
</section>

<!-- TYPE RESULT ONLY -->
<section id="typeResult" class="card hidden">
<h2>タイプ結果</h2>
<div id="typeText"></div>
<div class="rule"></div>
<div id="typeMap"></div>
<button onclick="showSkill()">能力も確認する</button>
<button onclick="downloadCSV()">CSV出力</button>
</section>

<!-- SKILL ONLY -->
<section id="skill" class="card hidden">
<h2>能力判定（7軸）</h2>
<div id="skillChecks"></div>
<button onclick="showResult()">結果を見る</button>
</section>

<!-- FINAL RESULT -->
<section id="result" class="card hidden">
<h2>最終結果</h2>
<div id="finalType"></div>

<div class="rule"></div>
<canvas id="radar" height="280"></canvas>
<button onclick="downloadPNG()">PNG保存</button>
<button onclick="downloadCSV()">CSV保存</button>

<div class="rule"></div>
<div id="typeMapFinal"></div>
</section>

</div>

<script>
/* ========= DATA ========= */
const TYPES=[
  {id:"yanki_aniki",label:"兄貴肌ヤンキー"},
  {id:"yanki_ubu",label:"うぶなヤンキー"},
  {id:"otaku_you",label:"陽キャオタク"},
  {id:"otaku_in",label:"陰キャオタク"},
  {id:"shokunin_soft",label:"柔軟な職人"},
  {id:"shokunin_hard",label:"頑固な職人"},
  {id:"artist_open",label:"ひらけたアーティスト"},
  {id:"artist_mystery",label:"不思議アーティスト"}
];

const TYPE_MAP={
  yanki_aniki:{x:-0.7,y:0.6},
  yanki_ubu:{x:-0.7,y:-0.6},
  otaku_you:{x:0.7,y:0.6},
  otaku_in:{x:0.7,y:-0.6},
  shokunin_soft:{x:0.25,y:0.2},
  shokunin_hard:{x:0.25,y:-0.3},
  artist_open:{x:-0.25,y:0.25},
  artist_mystery:{x:-0.25,y:-0.25}
};

const SKILLS=["課題定義力","コンセプト統合力","表現品質力","実装・成立力","自己省察力","合意形成力","視座更新力"];

/* ========= STATE ========= */
let mode=null;
let mainType="artist_open";
let subType="otaku_you";

/* ========= FUNCTIONS ========= */
function setMode(m){
  mode=m;
  document.getElementById("modeSelf").classList.toggle("selected",m==="self");
  document.getElementById("modeOther").classList.toggle("selected",m==="other");
  document.getElementById("startBtn").disabled=false;
}

function start(){
  document.getElementById("home").classList.add("hidden");
  showTypeResult();
}

function typeLabel(id){
  const t=TYPES.find(t=>t.id===id);
  return t.label+"系デザイナー";
}

/* ===== TYPE RESULT ===== */
function showTypeResult(){
  document.getElementById("typeResult").classList.remove("hidden");
  document.getElementById("typeText").innerHTML=
    `<b>メイン：</b>${typeLabel(mainType)}<br>
     <b>サブ：</b>${typeLabel(subType)}`;
  renderTypeMap("typeMap");
}

/* ===== SKILL ===== */
function showSkill(){
  document.getElementById("skill").classList.remove("hidden");
}

/* ===== FINAL ===== */
function showResult(){
  document.getElementById("result").classList.remove("hidden");
  document.getElementById("finalType").innerHTML=
    `<b>${typeLabel(mainType)}</b> / ${typeLabel(subType)}`;
  renderRadar();
  renderTypeMap("typeMapFinal");
}

/* ===== TYPE MAP ===== */
function renderTypeMap(target){
  const W=520,H=320,cx=W/2,cy=H/2,s=140;
  let svg=`<svg width="100%" viewBox="0 0 ${W} ${H}">`;
  svg+=`<line x1="${cx}" y1="20" x2="${cx}" y2="${H-20}" stroke="#e5e7eb"/>`;
  svg+=`<line x1="20" y1="${cy}" x2="${W-20}" y2="${cy}" stroke="#e5e7eb"/>`;

  TYPES.forEach(t=>{
    const p=TYPE_MAP[t.id];
    const x=cx+p.x*s,y=cy-p.y*s;
    svg+=`<circle cx="${x}" cy="${y}" r="4" fill="#999"/>`;
    svg+=`<text x="${x+6}" y="${y+4}" font-size="11" fill="#666">${t.label}</text>`;
  });

  let pM=TYPE_MAP[mainType];
  let pS=TYPE_MAP[subType];
  svg+=`<circle cx="${cx+pM.x*s}" cy="${cy-pM.y*s}" r="9" fill="#2563eb"/>`;
  svg+=`<circle cx="${cx+pS.x*s}" cy="${cy-pS.y*s}" r="7" fill="none" stroke="#2563eb" stroke-width="2"/>`;
  svg+="</svg>";
  document.getElementById(target).innerHTML=svg;
}

/* ===== RADAR ===== */
function renderRadar(){
  new Chart(document.getElementById("radar"),{
    type:"radar",
    data:{
      labels:SKILLS,
      datasets:[
        {label:"実測",data:[3,3,4,3,3,3,4]},
        {label:"平均",data:[3,3,3,3,3,3,3],borderDash:[4,4]}
      ]
    },
    options:{scales:{r:{min:1,max:5}}}
  });
}

/* ===== EXPORT ===== */
function downloadPNG(){
  const c=document.getElementById("radar");
  const a=document.createElement("a");
  a.href=c.toDataURL("image/png");
  a.download="radar.png";
  a.click();
}
function downloadCSV(){
  let csv="項目,値\n";
  csv+=`メインタイプ,${typeLabel(mainType)}\n`;
  csv+=`サブタイプ,${typeLabel(subType)}\n`;
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="result.csv";
  a.click();
}
</script>
</body>
</html>
